---
title: "R Markdown Tutorial"
author: "Heili Lowman"
date: "8/12/2020"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) # This sets global options for the entire document.
```

## R Markdown Introduction

At first glance, this looks a lot like any other R Script, except with more text.

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk by typing Mac: Command + Option + I or PC: Control + Alt + I.

```{r title_here, include = TRUE}

# Inside a code chunk works just like a script.
# Everything you type after a # symbol is a comment.

hummingbird <- 143

# If you run the above code line, it will also store the variables in your environment.

```

**NOTE TO SELF - Instruct them to delete the remainder of the document at this point and run it.**

Now, take a moment to type `include=FALSE` in the brackets next to your code chunk title. Re-knit your file and what happens?
Let's set this back to TRUE now, so it appears during our next knit.

You can use the following commands to achieve different results:

`include = FALSE` prevents code and results from appearing, but the chunk is still run.
`echo = FALSE` prevents code, but not the results from appearing.
`message = FALSE` prevents messages generated by code from appearing.
`warning = FALSE` prevents warnings generated by code from appearing.
`fig.cap = "..."` adds a caption to graphs.

As you may have guessed, there are also endless formatting options for text.

Two asterisks around text makes it **BOLD**.
A single asterisk around text makes it *ITALICIZED*.

* You can created a list using different bulleting options.
* Dashes or asterisks start the list.
  + And they can be continued using tabs on the next line.
  
(1) You can also use numbering if you like.
  + With a similar sub-heading notation.

And, of course, we can delimit parts of our code to create a table of contents.

## Test Header

### Level 2

The addition of pound symbols creates lower-level headers.

#### Level 3

Anything below four # may sometimes give you errors.

## Standard Workflow

Today, we're going to use RMarkdown to generate some figures in a manner that will allow you to use this document among collaborators who might not code themselves.

### Dataset

First, we'll need to load in our necessary packages and our dataset. The following code chunks will be masked from appearing in the final document. 

```{r packages, include = TRUE}

library(tidyverse)

```


```{r data, include = TRUE}

chemistry <- read_csv("tbl_chemresults.csv") # Importing data courtesy of Bowen.

```


### Exploration

Before performing any analyses, it's always a good idea to take a look at your actual dataset. If you're worried the code might throw off your collaborators, let's mask that.

```{r exploration, include = TRUE}

# Examine the structure of the data.
str(chemistry)

# Now, let's get a glimpse of the dataset.
glimpse(chemistry)

```


### Figures

For all of the figures below, we will also mask the code using `echo = FALSE` and any messages that appear using `message = FALSE`, but add in a figure caption for each.

```{r facet, echo = TRUE, message = FALSE, fig.cap = "Figure 1. Metals Facetted Barplot"}

# You can create multiple different figures at once using the facet feature.

# Let's take a look at the copper, zinc, and lead data from the samples, so let's create a new dataset.

metals <- chemistry %>%
  filter(analytename == "Copper" | analytename == "Zinc" | analytename == "Lead") %>%
  filter(sampletype == "Result" & qualifier == "none")

# Sampletype == "Result" means we filter out all of the standards and reference materials.
# Qualifier == "none" means there were no issues during the QAQC process.
# KNOW YOUR DATA! BRING YOUR BRAIN TO THE PARTY!

# Say we're interested in looking at mean values by analytical laboratory.

metals_summary <- metals %>% # Take the original dataset and then...
  group_by(analytename, lab) %>% # group by the groupings we're interested in and then...
  summarize(mean_conc = mean(result)) %>% # calculate the mean and standard deviation of results and then...
  ungroup # remove the groupings. Don't forget it!

# Create basic facetted bar plot.

fig1 <- ggplot(data = metals_summary, aes(x = lab, y = mean_conc)) +
  geom_bar(stat="identity") + # just a weird thing you need in there if the data is values instead of counts
  facet_wrap(~analytename) # facet by analytical laboratory

# Add in axes, title, and remove grey background.

fig1a <- ggplot(data = metals_summary, aes(x = lab, y = mean_conc)) +
  geom_bar(stat="identity") + # just a weird thing you need in there if the data is values instead of counts
  facet_wrap(~analytename) + # facet by analytical laboratory
  ggtitle("Metals Results by Lab") + # generates title above the plot
  ylab("Mean Result (ug/g dry weight)") + # labels y axis
  xlab("Analytical Laboratory") + # labels x axis
  theme_bw() # removes the grey background

# Remove x axis labels and instead color by laboratory.

fig1b <- ggplot(data = metals_summary, aes(x = lab, y = mean_conc, fill = lab)) + # fill = lab adds the coloration
  geom_bar(stat="identity") + # just a weird thing you need in there if the data is values instead of counts
  facet_wrap(~analytename) + # facet by analytical laboratory     
  ggtitle("Metals Results by Lab") + # generates title above the plot
  ylab("Mean Result (ug/g dry weight)") + # labels y axis
  xlab("Analytical Laboratory") + # labels x axis
  theme_bw() + # removes the grey background
  labs(fill = "Laboratories") + # changes legend title 
  theme(axis.text.x=element_blank()) # eliminates x axis labels

fig1b

```


```{r timeseries, echo = TRUE, message = FALSE, fig.cap = "Figure 2. Total Organic Carbon Timeseries"}

# Dates can be particularly nasty to deal with, so let's practice with them using the lubridate package.

# install.packages("lubridate")

library(lubridate)

# Filter out only the total organic carbon data and create a new column with the dates properly formatted.
TOC_data <- chemistry %>%
  filter(analytename == "TOC" & sampletype == "Result" & qualifier == "none") %>%
  mutate(date_format = mdy_hm(sampledate))

# Create basic timeseries scatterplot.

fig2 <- ggplot(data = TOC_data, aes(x = date_format, y = result, color = lab)) +
  geom_point()

# Add in axes, title, and remove grey background.

fig2a <- ggplot(data = TOC_data, aes(x = date_format, y = result, color = lab)) +
  geom_point() +
  ggtitle("Total Organic Carbon Data through Time") + 
  ylab("Result (ug/g dry weight)") + 
  xlab("Date") +
  labs(color = "Laboratories") +
  theme_minimal()

# Edit x axis labels and edit size/shading to view overlapping points better.

fig2b <- ggplot(data = TOC_data, aes(x = date_format, y = result, color = lab)) +
  geom_point(size = 3, alpha = 0.75) +
  ggtitle("Total Organic Carbon Data through Time") +
  ylab("Result (ug/g dry weight)") +
  xlab("Date") +
  labs(color = "Laboratories") +
  theme_minimal() +
  scale_x_datetime(date_breaks = "months" , date_labels = "%b-%Y")

fig2b

```


```{r geometries, echo = TRUE, fig.cap = "Figure 3. Color Palettes + Other Geometry"}

# install.packages("RColorBrewer")

library(RColorBrewer)

# Insert another figure with an added geometry of some kind (geom_line, geom_smooth, etc.).

# ggsave 

```

As you can see, there are a million ways you can plot your data.

*Note:* To save your machine from re-running everything and slowing, you can also add `cache = TRUE` inside the {} at the top of every code chunk. Knitr will then know only to re-run that chunk if something within it changes.

The last fun thing we'll learn today is how to add a hovering table of contents. At the very top of your document, edit your header to look like the following:

`output:`
  `html_document:`
    `toc: true`
    `toc_float: true`
    `toc_depth: 3`

End of R Markdown.
