---
title: "R Markdown Tutorial"
author: "Heili Lowman"
date: "8/12/2020"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) # This sets global options for the entire document.
```

## R Markdown Introduction

At first glance, this looks a lot like any other R Script, except with more text.

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk by typing Mac: Command + Option + I or PC: Control + Alt + I.

```{r title_here, include = TRUE}

# Inside a code chunk works just like a script.
# Everything you type after a # symbol is a comment.

hummingbird <- 143

# If you run the above code line, it will also store the variables in your environment.

```

**NOTE TO SELF - Instruct them to delete the remainder of the document at this point and run it.**

Now, take a moment to type `include=FALSE` in the brackets next to your code chunk title. Re-knit your file and what happens?
Let's set this back to TRUE now, so it appears during out next knit.

You can use the following commands to achieve different results:

`include = FALSE` prevents code and results from appearing, but the chunk is still run.
`echo = FALSE` prevents code, but not the results from appearing.
`message = FALSE` prevents messages generated by code from appearing.
`warning = FALSE` prevents warnings generated by code from appearing.
`fig.cap = "..."` adds a caption to graphs.

As you may have guessed, there are also endless formatting options for text.

Two asterisks around text makes it **BOLD**.
A single asterisk around text makes it *ITALICIZED*.

* You can created a list using different bulleting options.
* Dashes or asterisks start the list.
  + And they can be continued using tabs on the next line.
  
(1) You can also use numbering if you like.
  + With a similar sub-heading notation.

And, of course, we can delimit parts of our code to create a table of contents.

## Test Header

### Level 2

#### Level 3

## Standard Workflow

Today, we're going to use RMarkdown to generate some figures in a manner that will allow you to use this document among collaborators who might not code themselves.

### Dataset

First, we'll need to load in our necessary packages and our dataset. The following code chunks will be masked from appearing in the final document. 

```{r packages, include = FALSE}

library(tidyverse)

```

```{r data, include = FALSE}

chemistry <- read_csv("tbl_chemresults.csv") # Importing data courtesy of Bowen.

```


### Exploration

Before performing any analyses, it's always a good idea to take a look at your actual dataset. If you're worried the code might throw off your collaborators, let's mask that.

```{r exploration, include = FALSE}

# Examine the structure of the data.
str(chemistry)

# Each figure below will look at a different analyte, so let's make a new column that allows us to filter by analyte as a factor.

chemistry <- chemistry %>%
  mutate(analytename_f = as_factor(analytename))

# Now, let's take a look at how many different analytes there are. WOW 158!
levels(chemistry$analytename_f)

```


### Figures

For all of the figures below, we will also mask the code, but add in a figure caption for each.

```{r histogram, echo = FALSE, fig.cap = "Figure 1. Mercury Histogram"}

# Histograms are excellent figures for initial data exploration analyses.

# First, we're only interested in the mercury data from samples, so let's filter for it.

Hg_data <- chemistry %>%
  filter(analytename == "Mercury" & sampletype == "Result" & qualifier == "none")

fig1 <- ggplot(data = Hg_data, aes(x = result)) +
  geom_histogram(binwidth = 0.01) + #
  ggtitle("Mercury Data Exploration") + ##
  ylab("Count") + ##
  xlab("Result (ug/g dry weight)") ##

fig1

# Edit bin width to be more appropriate.
## If we like this better, be sure to add a good title and axes labels.

```


```{r facet, echo = FALSE, fig.cap = "Figure 2. Nickel Facetted Barplot"}

# You can create multiple different figures at once using the facet feature.

# Let's take a look at the nickel data from the samples, so again, let's create a new dataset.

Ni_data <- chemistry %>%
  filter(analytename == "Nickel" & sampletype == "Result" & qualifier == "none")

fig2 <- ggplot(data = Ni_data, aes(x = stationid, y = result)) +
  geom_bar(stat="identity") + # just a weird thing you need in there if the data is values instead of counts
  facet_wrap(~lab, scales = "free_x") + #     ##
  ggtitle("Nickel Data by Lab") + ###
  ylab("Result (ug/g dry weight)") + ###
  xlab("Station ID") ###

fig2

# Go back and add "facet_wrap(~lab)".
## Then go back and add "scales = "free_x".
### Title and axis labels last.

```


```{r scatterplot, echo = FALSE, fig.cap = "Figure 3. Total Organic Carbon Timeseries"}

# Dates can be particularly nasty to deal with, so let's practice with them using the lubridate package.

# install.packages("lubridate")

library(lubridate)

TOC_data <- chemistry %>%
  filter(analytename == "TOC" & sampletype == "Result" & qualifier == "none") %>%
  mutate(date_format = mdy_hm(sampledate))

fig3 <- ggplot(data = TOC_data, aes(x = date_format, y = result)) +
  geom_point(aes(color = lab)) +
  scale_x_datetime(date_breaks = "months" , date_labels = "%b-%Y") + #
  theme(legend.position="bottom") + ##
  ggtitle("Total Organic Carbon Data through Time") + ###
  ylab("Result (ug/g dry weight)") + ###
  xlab("Date") ###

fig3

# Go back and add x axis date formatting.
## Put legend along the bottom.
### Title and axis labels last.

```


```{r palette, echo = FALSE, fig.cap = "Figure 4. Metals Boxplots using RColorBrewer"}

# Another good data exploration tool is the boxplot.
# We'll be using a special color package for this one.

# install.packages("RColorBrewer")

library(RColorBrewer)

Metals_data <- chemistry %>%
  filter(analytename == "Aluminum" | analytename == "Iron" | analytename == "Copper" | analytename == "Lead") %>%
  filter(sampletype == "Result" & qualifier == "none")

fig4 <- ggplot(data = Metals_data, aes(x = analytename, y = result)) +
  geom_boxplot(aes(color = analytename)) +
  scale_colour_brewer("Analyte Name", palette="Set2") + #
  theme_bw() + ##
  ggtitle("Selected Metals Data") + ###
  ylab("Result (ug/g dry weight)") + ###
  xlab("Analyte Name") ###

fig4

# Add color palette.
## Remove grey background.
### Title and axis labels last.

```


```{r geometries, echo = FALSE, fig.cap = "Figure 5. Scatterplot + Other Geometry"}

# Insert another geom_point with an added geometry of some kind (geom_line, geom_smooth, etc.).
#ggsave

```

As you can see, there are a million ways you can plot your data.

Go ahead and make a new figure (choose from any of the formats above) and see if you can change the color of the plotting.

Note: To save your machine from re-running everything and slowing, you can also add `cache = TRUE` inside the {} at the top of every code chunk. Knitr will then know only to re-run that chunk if something within it changes.

The last fun thing we'll learn today is how to add a hovering table of contents. At the very top of your document, edit your header to look like the following:

`output:`
  `html_document:`
    `toc: true`
    `toc_float: true`
    `toc_depth: 3`

End of R Markdown.
